# CAEN Digitizer Parser

A comprehensive Python library for parsing and analyzing data from CAEN digitizers, supporting multiple file formats including XML configuration files and binary data files (RAW, WBIN).

## üöÄ Features

- **Multi-format support**: Parse XML configuration files, RAW binary files (Scope Software)
- **Multiple digitizer models**: Support for WaveDump2 bin format
- **Pandas integration**: Convert waveform data to pandas DataFrames
- **Flexible measurement units**: Support for voltage or ADC counts

## üì¶ Installation

### Prerequisites

- Python 3.12+
- C++11 compatible compiler (gcc/g++ on Linux, Visual Studio on Windows)
- pip package manager

### Create Virtual Environment (Recommended)

```bash
# Create virtual environment
python -m venv venv

# Activate virtual environment
# On Linux/Mac:
source venv/bin/activate
# On Windows:
venv\Scripts\activate
```

### Install from Source

```bash
# Clone the repository
git clone <repository-url>
cd MainzDigitizer

# Install in development mode (recommended)
pip install -e .

# Or install normally
pip install .
```

### Dependencies

The following packages will be installed automatically:

- `pandas >= 2.3.0` - Data manipulation and analysis
- `pybind11 >= 2.6.0` - C++ binding library
- `numpy >= 1.26.0` - Numerical computing (via pandas)

### Verify Installation

```bash
# Test the command line interface
mainz-digitizer --help

# Or test Python import
python -c "import caenParser; print('Installation successful!')"
```

## üîß Build Process

The installation includes compiling C++ extensions for efficient binary file parsing:

### Manual Build (if needed)

```bash
# Clean previous builds
make clean

# Build and install
make install

# Or using setuptools directly
python setup.py build_ext --inplace
```

### Common Installation Issues

#### Missing Compiler
**Linux (Ubuntu/Debian):**
```bash
sudo apt update
sudo apt install build-essential python3-dev
```

**Linux (CentOS/RHEL):**
```bash
sudo yum groupinstall "Development Tools"
sudo yum install python3-devel
```

**macOS:**
```bash
xcode-select --install
```

#### Windows
Install Visual Studio Build Tools or Visual Studio Community with C++ support.

## üéØ Quick Start

### Command Line Interface
```bash
# Run the main application
mainz-digitizer

# Or using Python module
python -m caenParser
```

### Python API

```python
from caenParser import PersistenceController

# Load XML configuration
controller = PersistenceController()
controller.load_file("config.xml", file_type="xml")

# Access digitizer information
digitizers = controller.get_digitizers()
settings = controller.get_settings()

print(f"Found {len(digitizers)} digitizers")
```

## üîÑ Updating

```bash
# If installed with -e flag
git pull origin main
pip install -e . --force-reinstall

# If installed normally
git pull origin main
pip install . --upgrade
```

## üóëÔ∏è Uninstallation

```bash
pip uninstall caenParser
```
## üîç Troubleshooting

### Import Errors
If you get import errors, ensure your Python path includes the package:
```bash
python -c "import sys; print(sys.path)"
```

### Build Errors
Check that you have all required development tools:
```bash
gcc --version  # Should show compiler version
python --version  # Should be 3.12+
```

### Permission Errors
On Linux/Mac, you might need to use `sudo` or check file permissions:
```bash
# Don't use sudo with pip in virtual environments
# Instead, check virtual environment activation
which python  # Should point to venv/bin/python
```

## üìã System Requirements

- **Operating System**: Linux, macOS, Windows
- **Python**: 3.12 or higher
- **Memory**: At least 512MB RAM
- **Disk Space**: ~50MB for installation
- **Network**: Required for downloading dependencies

## WaveDump2BinParser

`WaveDump2BinParser` is a class designed for efficient parsing of binary files generated by WaveDump2. Instead of loading the entire file into memory‚Äîwhich could lead to memory crashes with large files‚Äîit takes the path to the binary file and returns an iterator over its events. This iterator yields one event at a time, enabling memory-efficient processing and analysis of event data.

**Example usage:**
```python
from caenParser import WaveDump2BinParser

parser = WaveDump2BinParser("data.bin")
for event in parser:
    # Process each event individually
    print(event)
```
